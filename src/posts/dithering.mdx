---
title: Add Some Noise!
description: Who doesn't love smooth gradients in their designs? However great look comes with a price - thousands of unique colors, the compression algorithms' worst nightmare. Have you ever tried to use your favorite image on some social platform and ended up with seamless blend of colors had annoying stepped color bands? Don't worry we did that too!
publishDate: 2024-11-16
cover: dithering.png
readTime: 7
authors:
 - Michał Kalinowski
 - Kordian Grabowski
tags:
  - Compression
---

# Add Some Noise!

Who doesn't love smooth gradients in their designs? However, a great look comes at a price - thousands of unique colors, the worst nightmare of compression algorithms. Have you ever tried to use your favorite image on a social platform and ended up with a seamless color blend that had annoying stepped bands? Don't worry, we've been there too!

<Image src={'/bad-gradient.png'} caption={'Example of color banding after compression' } />

This is because these platforms need to balance visual quality with bandwidth constraints and storage costs. To achieve these goals, all uploaded images go through the compression pipelines, losing their original resolution and, most importantly in our case, color depth.

If you don't want to make the silly mistake we did, read on to learn about ways to mitigate gradient banding through selective dithering techniques. We believe this can significantly reduce common artifacts while maintaining optimal file sizes. Although we focus on gradient backgrounds as an example, the approach described could easily be extended to other types of visual content.

## Understand the Challenge

The typical compression pipeline reduces the number of bits used to represent each color channel. For example, reducing from 8 bits per channel to 4 bits means going from 256 possible values to just 16. This quantization is what creates those visible steps in gradients where subtle transitions should be.

To put this into perspective:

Original image: 8-bits per channel = 256 × 256 × 256 = 16.7 million possible colors

After compression: 4-bits per channel = 16 × 16 × 16 = 4096 possible colors

This massive reduction to just 4,096 colors is why smooth gradients suffer so dramatically. Even a simple linear gradient, which may originally have contained thousands of subtle color variations, is forced to use far fewer distinct values, making the banding much more visible to the human eye.

## Choose the Pattern Size Wisely

When applying dithering to reduce banding, we're essentially trading color precision for spatial patterns. However, these patterns need to survive the compression process. This brings us to a crucial concept: spatial frequency preservation.

Most image compression algorithms work on fixed 8x8 pixel blocks. Any pattern frequencies higher than half the block size (known as the Nyquist frequency) will be lost during compression. Therefore, our dither patterns must be designed with these compression blocks in mind.

[PRZYKŁAD jak z fragmentu obrazka uciekają detale]

A practical approach is:

- Align dither patterns with 8x8 compression blocks
- Use patterns that are no smaller than 2x2 pixels to ensure they survive compression
- Consider the viewing distance - larger patterns are more visible but survive compression better

## See It In Practice 
   
Experiment with different dithering techniques optimized for social media compression. Toggle the grid to see
8x8 JPEG compression blocks.
   
<DitheredGradient />

<Note mb={0} type={'info'} title={'Important!'}>
Most compression algorithms reduce colors within 8x8 pixel blocks. Dither patterns
aligned to these blocks have a better chance of surviving compression.
</Note>

## Learn About Different Ways to Dither

Let's explore how different dithering techniques handle this balance:

1. Floyd-Steinberg Dithering:

   - Uses error diffusion in a specific direction (typically left-to-right, top-to-bottom)
   - Distributes quantization errors to neighboring pixels
   - Creates organic-looking patterns due to its error distribution method
   - Works well for photographic content due to its ability to preserve local detail

2. Ordered (Bayer) Dithering:

   - Uses a fixed pattern matrix for predictable results
   - Pattern size can be adjusted to match compression blocks
   - More efficient computationally than error diffusion
   - Better for geometric designs due to its regular pattern

3. Pseudo-Random Dithering:
   - Adds noise based on a predetermined pattern
   - Can break up banding but with less control than other methods
   - Generally produces lower quality results than ordered dithering
   - Useful for quick previews or when processing speed is critical

## Be Smart!

Not all parts of an image need the same treatment. This is where selective dithering comes in - applying different techniques to different areas based on their content:

1. Gradient Detection

   - Analyze local color differences to identify potential banding areas
   - Consider both color changes and their rates of change
   - Look for areas where color steps would be most visible to human vision

2. Pattern Selection

   - Choose patterns based on the compression block grid (8x8 pixels)
   - Align patterns with block boundaries to maximize survival
   - Consider both compression and human visual perception

3. Content-Aware Processing
   - Leave high-frequency details (like text and edges) undithered
   - Apply dithering primarily to large, smooth areas
   - Use gradient analysis to determine dithering strength

## Control the Side Effects

While dithering can effectively combat banding, it needs careful implementation to avoid introducing new problems. Here's how to optimize the process:

1. Apply dithering selectively to areas prone to banding
2. Ensure dither patterns align with compression block boundaries
3. Consider the balance between pattern visibility and compression survival
4. Test results with your target compression settings

## Don't Let Your Work Be Destroyed

By using selective dithering techniques thoughtfully, we can achieve better image quality while meeting platform requirements. While this approach requires more initial setup, understanding the relationship between dither patterns and compression blocks allows us to maintain visual quality where it matters most.

<div style={{display: 'flex', width: '100%', gap: '10px'}}>
   <Image src={'/guided-generation.png'} mb={0} />
   <Image src={'/bad-gradient.png'} mb={0} />
</div>
<Caption mt={'sm'}>The devil is in the details. Can you notice where dithering was applied?</Caption>


Remember: the goal isn't to fight compression entirely, but to work with it intelligently. By understanding how compression affects different image elements and applying dithering selectively, we can maintain visual quality while keeping file sizes reasonable.